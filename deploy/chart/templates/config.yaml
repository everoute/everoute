---
apiVersion: v1
data:
  agentconfig.yaml: |
    datapathConfig:
      {{ .Values.bridgeName }}: {{ .Values.bridgeName }}
    enableCNI: {{ .Values.enableCNI }}
    CNIConf:
      localGwIP: {{ .Values.CNIConf.localGwIP }}
      # enable everoute proxy
      enableProxy: {{ .Values.CNIConf.enableProxy }}
      # encapMode: geneve # use overlay mode
      {{- if ne (.Values.CNIConf.encapMode | default "") "" }}
      encapMode: {{ .Values.CNIConf.encapMode }}
      {{- end}}
      # specified pod mtu, default value is 0, when mtu=0, the pod mtu will set according to node mtu
      mtu: {{ .Values.CNIConf.mtu }}
      # specified encap vni, only valid when encapMode isn't empty, default is 5000 
      vni: {{ .Values.CNIConf.vni }}
      # ipam: everoute # use everoute ipam
      {{- if ne (.Values.CNIConf.ipam | default "") "" }}
      ipam: {{ .Values.CNIConf.ipam }}
      {{- end}}
  cni-conf.conflist: |
    {
        "cniVersion": "0.3.0",
        "name": "everoute",
        "plugins": [
            {
                "type": "everoute"
            },
            {
                "type": "portmap",
                "capabilities": {"portMappings": true}
            }
        ]
    }
  controllerconfig.yaml: |
    enableCNI: {{ .Values.enableCNI }}
    CNIConf:
      # enable everoute proxy
      enableProxy: {{ .Values.CNIConf.enableProxy }}
      # encapMode: geneve # use overlay mode
      {{- if ne (.Values.CNIConf.encapMode | default "") "" }}
      encapMode: {{ .Values.CNIConf.encapMode }}
      {{- end}}
kind: ConfigMap
metadata:
  annotations: {}
  labels:
    app: everoute
  name: everoute-config-xu73od84d3
  namespace: kube-system